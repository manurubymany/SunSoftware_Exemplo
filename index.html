<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Interno TI — SUN SOFTWARES</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Geist+Mono:wght@300;400;500&family=Geist:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
a{text-decoration:none;color:inherit;}
button{cursor:pointer;font-family:inherit;border:none;background:none;}
[data-theme="dark"]{
  --bg:#0C0C12;--bg2:#13131F;--bg3:#1A1A2A;
  --sb:#0F0F1A;--hdr:#0F0F1A;--card:#13131F;
  --p:#6A0DAD;--ph:#8B2FD4;--pdim:#2D0760;--acc:#9B4DFF;
  --t:#F0F0F8;--t2:#8A8DA8;--t3:#5A5D78;
  --bd:#1E1E30;--bd2:#252538;--inp:#0C0C12;
  --rh:rgba(106,13,173,.09);
  --sh:0 1px 3px rgba(0,0,0,.4),0 4px 16px rgba(0,0,0,.3);
  --shlg:0 8px 32px rgba(0,0,0,.5);
}
[data-theme="light"]{
  --bg:#F2F2F8;--bg2:#FFFFFF;--bg3:#EAEAF2;
  --sb:#EAEAF0;--hdr:#5B0A9C;--card:#FFFFFF;
  --p:#6A0DAD;--ph:#8B2FD4;--pdim:#E8D8FA;--acc:#7B3FEE;
  --t:#0E0E18;--t2:#555570;--t3:#8888A8;
  --bd:#E0E0EE;--bd2:#D0D0E0;--inp:#FFFFFF;
  --rh:rgba(106,13,173,.04);
  --sh:0 1px 3px rgba(0,0,0,.08),0 4px 16px rgba(0,0,0,.06);
  --shlg:0 8px 32px rgba(0,0,0,.12);
}
:root{
  --bug:#F04040;--mel:#2ECC71;--aj:#F5A623;--fix:#FF6B35;
  --blue:#3B82F6;--lblue:#60A5FA;
  --tr:.25s cubic-bezier(.4,0,.2,1);
  --r:10px;--rl:14px;--rxl:18px;
}
html,body{height:100%;}
body{font-family:'Geist','DM Sans',sans-serif;background:var(--bg);color:var(--t);font-size:14px;line-height:1.5;-webkit-font-smoothing:antialiased;transition:background var(--tr),color var(--tr);}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:99px;}

/* LOGIN */
#ls{position:fixed;inset:0;z-index:9999;background:#080810;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.lbg{position:absolute;inset:0;background:radial-gradient(ellipse 700px 500px at 20% 80%,rgba(106,13,173,.18) 0%,transparent 70%),radial-gradient(ellipse 500px 400px at 80% 20%,rgba(80,10,140,.12) 0%,transparent 70%);}
.llines{position:absolute;inset:0;opacity:.06;background-image:repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,255,255,.15) 40px),repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,255,255,.15) 40px);}
.lcard{position:relative;z-index:1;width:400px;max-width:95vw;background:rgba(15,15,26,.92);border:1px solid rgba(106,13,173,.3);border-radius:var(--rxl);padding:48px 44px;box-shadow:0 0 60px rgba(106,13,173,.15),0 40px 80px rgba(0,0,0,.6);backdrop-filter:blur(24px);animation:sup .55s cubic-bezier(.16,1,.3,1) both;}
@keyframes sup{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.lmark{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;letter-spacing:-.3px;color:#fff;margin-bottom:4px;}
.lmark strong{color:#9B4DFF;}
.ltag{font-size:12px;color:rgba(138,141,168,.7);letter-spacing:.4px;text-transform:uppercase;margin-bottom:36px;}
.lf{margin-bottom:16px;}
.lf label{display:block;font-size:11px;font-weight:600;color:rgba(138,141,168,.8);letter-spacing:.6px;text-transform:uppercase;margin-bottom:7px;}
.lf input{width:100%;padding:12px 14px;background:rgba(8,8,18,.7);border:1px solid rgba(255,255,255,.08);border-radius:var(--r);color:#fff;font-size:14px;font-family:inherit;outline:none;transition:border-color var(--tr),box-shadow var(--tr);}
.lf input:focus{border-color:rgba(106,13,173,.6);box-shadow:0 0 0 3px rgba(106,13,173,.15);}
.lf input::placeholder{color:rgba(138,141,168,.3);}
.lbtn{width:100%;margin-top:8px;padding:13px;background:var(--p);border-radius:var(--r);color:#fff;font-size:14px;font-weight:600;font-family:'Syne',sans-serif;box-shadow:0 0 24px rgba(106,13,173,.35);transition:background var(--tr),box-shadow var(--tr),transform .12s;}
.lbtn:hover{background:var(--ph);box-shadow:0 0 40px rgba(139,47,212,.45);transform:translateY(-1px);}
.lerr{margin-top:12px;font-size:12px;color:var(--bug);text-align:center;display:none;animation:shake .3s;}
.lerr.on{display:block;}
@keyframes shake{0%,100%{transform:translateX(0)}30%{transform:translateX(-5px)}70%{transform:translateX(5px)}}
.lhint{margin-top:14px;text-align:center;font-size:11px;color:rgba(138,141,168,.3);}

/* APP */
#app{display:none;min-height:100vh;}
#app.on{display:block;}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;z-index:600;height:58px;background:var(--hdr);border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;padding:0 24px;transition:background var(--tr);}
[data-theme="light"] header{border-bottom-color:rgba(0,0,0,.1);}
.hlogo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:#fff;letter-spacing:-.2px;white-space:nowrap;margin-right:40px;}
.hlogo strong{color:rgba(200,160,255,.9);}
nav{display:flex;align-items:center;gap:2px;flex:1;}
.nitem{padding:6px 15px;border-radius:7px;font-size:13.5px;font-weight:500;color:rgba(255,255,255,.6);transition:background var(--tr),color var(--tr);white-space:nowrap;}
.nitem:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.9);}
.nitem.on{background:rgba(106,13,173,.4);color:#fff;}
.hright{margin-left:auto;display:flex;align-items:center;gap:10px;}
.husr{display:flex;align-items:center;gap:9px;font-size:13px;color:rgba(255,255,255,.7);}
.hav{width:30px;height:30px;border-radius:7px;background:var(--p);display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:#fff;}
.hibtn{width:34px;height:34px;border-radius:7px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,.7);font-size:15px;transition:background var(--tr);}
.hibtn:hover{background:rgba(255,255,255,.13);}
.hlout{padding:6px 14px;border-radius:7px;background:rgba(240,64,64,.12);border:1px solid rgba(240,64,64,.2);color:#F07070;font-size:12.5px;font-weight:500;transition:background var(--tr);}
.hlout:hover{background:rgba(240,64,64,.2);}

/* LAYOUT */
#layout{margin-top:58px;display:flex;min-height:calc(100vh - 58px);}

/* SIDEBAR */
#sb{width:230px;min-width:230px;background:var(--sb);border-right:1px solid var(--bd);position:sticky;top:58px;height:calc(100vh - 58px);overflow-y:auto;flex-direction:column;display:none;transition:background var(--tr),border-color var(--tr);}
#sb.on{display:flex;}
.sbph{padding:20px 18px 14px;border-bottom:1px solid var(--bd);}
.sbpn{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--t);}
.sbps{font-size:11px;color:var(--t3);margin-top:2px;}
.sbsl{padding:18px 18px 7px;font-size:10px;font-weight:700;color:var(--t3);letter-spacing:1px;text-transform:uppercase;}
.sbi{display:flex;align-items:center;gap:10px;padding:9px 18px;font-size:13px;color:var(--t2);font-weight:400;width:100%;text-align:left;position:relative;transition:background var(--tr),color var(--tr);}
.sbi::before{content:'';position:absolute;left:0;top:4px;bottom:4px;width:2px;border-radius:0 2px 2px 0;background:var(--p);opacity:0;transition:opacity var(--tr);}
.sbi:hover{background:var(--rh);color:var(--t);}
.sbi.on{background:rgba(106,13,173,.12);color:var(--acc);font-weight:500;}
.sbi.on::before{opacity:1;}
.sbic{width:16px;display:flex;align-items:center;justify-content:center;opacity:.55;}
.sbi.on .sbic{opacity:1;}
.sbdv{height:1px;background:var(--bd);margin:6px 0;}
.sbbk{margin:auto 12px 12px;padding:8px 14px;border:1px solid var(--bd2);border-radius:var(--r);font-size:12px;color:var(--t2);text-align:center;width:calc(100% - 24px);transition:all var(--tr);}
.sbbk:hover{border-color:var(--p);color:var(--acc);}

/* PAGE */
#pa{flex:1;min-width:0;padding:36px 40px;overflow-y:auto;}
@media(max-width:900px){#pa{padding:24px 20px;}}

/* TYPOGRAPHY */
.ptitle{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;color:var(--t);letter-spacing:-.4px;line-height:1.1;}
.pdesc{font-size:13px;color:var(--t2);margin-top:5px;}
.phdr{margin-bottom:32px;}
.slbl{font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--t3);margin:28px 0 14px;display:flex;align-items:center;gap:12px;}
.slbl::after{content:'';flex:1;height:1px;background:var(--bd);}
.dvdr{height:1px;background:var(--bd);margin:24px 0;}

/* CARDS */
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px;}
.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:22px 22px 20px;position:relative;overflow:hidden;transition:transform .2s,box-shadow .2s,border-color .2s,background var(--tr);}
.card:hover{transform:translateY(-2px);box-shadow:var(--shlg);border-color:var(--bd2);}
.cab{border-top:2px solid var(--bug);}
.cam{border-top:2px solid var(--mel);}
.caa{border-top:2px solid var(--aj);}
.cai{border-top:2px solid var(--p);}
.tag{display:inline-flex;align-items:center;gap:5px;padding:3px 9px;border-radius:5px;font-size:10.5px;font-weight:600;letter-spacing:.3px;text-transform:uppercase;margin-bottom:12px;}
.tbug{background:rgba(240,64,64,.12);color:var(--bug);}
.tmel{background:rgba(46,204,113,.12);color:var(--mel);}
.taj{background:rgba(245,166,35,.12);color:var(--aj);}
.tinfo{background:rgba(106,13,173,.15);color:var(--acc);}
.tfix{background:rgba(255,107,53,.12);color:var(--fix);}
.card h3{font-family:'Syne',sans-serif;font-size:14.5px;font-weight:700;margin-bottom:7px;color:var(--t);}
.card p,.card-p{font-size:13px;color:var(--t2);line-height:1.6;}
.cmeta{display:flex;align-items:center;flex-wrap:wrap;gap:12px;margin-top:14px;padding-top:13px;border-top:1px solid var(--bd);font-size:11.5px;color:var(--t3);}

/* TIMELINE */
.tl{padding-left:24px;position:relative;}
.tl::before{content:'';position:absolute;left:6px;top:6px;bottom:0;width:1px;background:var(--bd);}
.tli{position:relative;margin-bottom:24px;}
.tld{position:absolute;left:-21px;top:5px;width:12px;height:12px;border-radius:50%;border:2px solid var(--bg);}
.dbug{background:var(--bug);}
.dmel{background:var(--mel);}
.daj{background:var(--aj);}
.dfix{background:var(--fix);}
.tlc{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:18px 20px;transition:background var(--tr),border-color .2s;animation:fup .35s ease both;}
.tlc:hover{border-color:var(--bd2);}
@keyframes fup{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.tlm{display:flex;align-items:center;gap:8px;margin-bottom:9px;flex-wrap:wrap;}
.tdate{font-family:'Geist Mono',monospace;font-size:11.5px;color:var(--t3);}
.tver{font-family:'Geist Mono',monospace;font-size:10.5px;padding:2px 7px;border-radius:4px;background:rgba(106,13,173,.18);color:var(--acc);}
.tlc h4{font-size:14px;font-weight:600;margin-bottom:5px;}
.tlc p{font-size:13px;color:var(--t2);line-height:1.6;}

/* TABLE */
.tw{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);overflow:hidden;transition:background var(--tr);}
table{width:100%;border-collapse:collapse;}
thead tr{background:rgba(106,13,173,.08);border-bottom:1px solid var(--bd);}
th{padding:13px 18px;text-align:left;font-size:10.5px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--t3);white-space:nowrap;}
td{padding:13px 18px;font-size:13px;border-top:1px solid var(--bd);}
tbody tr:hover td{background:var(--rh);}
.mono{font-family:'Geist Mono',monospace;font-size:12px;}

/* PILLS */
.pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;}
.pg{background:rgba(46,204,113,.12);color:var(--mel);}
.py{background:rgba(245,166,35,.12);color:var(--aj);}
.pu{background:rgba(155,77,255,.15);color:var(--acc);}
.pr{background:rgba(240,64,64,.12);color:var(--bug);}
.pf{background:rgba(255,107,53,.12);color:var(--fix);}

/* STATS */
.srow{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;margin-bottom:24px;}
.scard{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:20px;transition:background var(--tr);}
.slb{font-size:10.5px;font-weight:600;letter-spacing:.6px;text-transform:uppercase;color:var(--t3);margin-bottom:8px;}
.sval{font-family:'Syne',sans-serif;font-size:30px;font-weight:800;line-height:1;}
.ssub{font-size:11.5px;color:var(--t3);margin-top:4px;}

/* BAR CHART */
.bcc{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:24px;}
.bct{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:20px;}
.bc-wrap{display:flex;height:160px;gap:12px;font-family:'Geist Mono',monospace;}
.bc-y{display:flex;flex-direction:column;justify-content:space-between;padding-bottom:26px;text-align:right;font-size:10px;color:var(--t3);min-width:24px;}
.bc-canvas{flex:1;position:relative;display:flex;align-items:flex-end;border-bottom:1px solid var(--bd2);padding-bottom:0;}
.bc-grid{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-between;pointer-events:none;}
.bc-line{width:100%;border-top:1px dashed var(--bd2);opacity:0.4;height:1px;}
.bc-col{flex:1;height:100%;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;position:relative;z-index:1;cursor:pointer;padding:0 4px;}
.bc-bar{width:100%;border-radius:4px 4px 0 0;transition:all .2s;position:relative;min-height:2px;animation:bgrow .8s cubic-bezier(.16,1,.3,1);background-image:linear-gradient(to bottom,rgba(255,255,255,0.15),transparent);}
@keyframes bgrow{from{height:0}}
.bc-col:hover .bc-bar{filter:brightness(1.2);transform:scaleX(1.05);}
.bc-val{font-size:11px;font-weight:700;color:var(--t);margin-bottom:6px;opacity:0;transform:translateY(5px);transition:all .2s;}
.bc-col:hover .bc-val{opacity:1;transform:translateY(0);}
.bc-lbl{position:absolute;top:100%;left:50%;transform:translateX(-50%);text-align:center;font-size:10px;color:var(--t3);margin-top:8px;white-space:nowrap;}
.tooltip{position:absolute;bottom:100%;left:50%;transform:translateX(-50%) translateY(-5px);background:var(--bg2);border:1px solid var(--bd2);color:var(--t);padding:6px 10px;border-radius:6px;font-size:11px;font-weight:600;white-space:nowrap;opacity:0;pointer-events:none;transition:all .2s;box-shadow:var(--sh);z-index:10;}
.bc-col:hover .tooltip{opacity:1;transform:translateY(-10px);}

/* PIE CHART */
.pc-wrap{display:flex;align-items:center;justify-content:center;gap:24px;position:relative;}
.pc-svg{width:130px;height:130px;transform:rotate(-90deg);overflow:visible;}
.pc-slice{transition:opacity .2s,transform .2s;cursor:pointer;transform-origin:center;stroke:var(--card);stroke-width:2px;vector-effect:non-scaling-stroke;paint-order:stroke;}
.pc-slice:hover{opacity:.9;transform:scale(1.06);}
.pc-center{position:absolute;left:0;width:130px;height:130px;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none;z-index:10;}
.pc-total{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;line-height:1;color:var(--t);}
.pc-sub{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-top:2px;}
.pc-leg{display:flex;flex-direction:column;gap:8px;}
.pc-li{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--t2);}
.pc-dot{width:10px;height:10px;border-radius:3px;}

/* NEWSPAPER LAYOUT */
.np-head{border-bottom:1px solid var(--bd);padding-bottom:24px;margin-bottom:32px;display:flex;justify-content:space-between;align-items:flex-end;}
.np-brand{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--acc);margin-bottom:6px;}
.np-title{font-family:'Syne',sans-serif;font-size:38px;font-weight:800;line-height:1;color:var(--t);letter-spacing:-1px;}
.np-info{text-align:right;font-family:'Geist Mono',monospace;}
.np-ver{font-size:20px;font-weight:600;color:var(--t);}
.np-lbl{font-size:11px;color:var(--t3);}
.np-grid{display:grid;grid-template-columns:1.8fr 1fr;gap:40px;}
@media(max-width:900px){.np-grid{grid-template-columns:1fr;}}
.np-hero{position:relative;}
.np-hero-tag{margin-bottom:16px;display:flex;align-items:center;gap:10px;font-size:12px;color:var(--t3);font-family:'Geist Mono',monospace;}
.np-h1{font-family:'Syne',sans-serif;font-size:34px;font-weight:800;line-height:1.15;margin-bottom:18px;color:var(--t);}
.np-lead{font-size:16px;color:var(--t2);line-height:1.6;margin-bottom:24px;}
.np-meta{display:flex;gap:16px;font-size:12px;color:var(--t3);border-top:1px solid var(--bd);padding-top:18px;}
.np-side{display:flex;flex-direction:column;gap:24px;border-left:1px solid var(--bd);padding-left:30px;}
@media(max-width:900px){.np-side{border-left:none;padding-left:0;border-top:1px solid var(--bd);padding-top:30px;}}
.np-sec{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:12px;border-bottom:2px solid var(--p);display:inline-block;padding-bottom:4px;}
.np-card{padding-bottom:24px;border-bottom:1px solid var(--bd2);}
.np-card:last-child{border-bottom:none;padding-bottom:0;}
.np-h2{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;margin-bottom:8px;color:var(--t);line-height:1.35;transition:color .2s;}
.np-card:hover .np-h2{color:var(--acc);}
.np-p{font-size:13.5px;color:var(--t2);line-height:1.55;}

/* PROGRESS */
.pr-row{margin-bottom:12px;padding:0 4px;cursor:default;}
.pr-hdr{display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px;align-items:center;}
.pr-lbl{color:var(--t2);font-weight:500;}
.pr-val{color:var(--t);font-weight:600;}
.pr-trk{height:6px;border-radius:99px;background:var(--bd2);overflow:hidden;}
.pr-fil{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--p),var(--acc));}

/* FORMS */
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:600px){.fgrid{grid-template-columns:1fr;}}
.ff{display:flex;flex-direction:column;gap:6px;}
.ff label{font-size:11px;font-weight:600;color:var(--t2);letter-spacing:.5px;text-transform:uppercase;}
.ff input,.ff select,.ff textarea{padding:11px 13px;background:var(--inp);border:1px solid var(--bd2);border-radius:var(--r);color:var(--t);font-size:13.5px;font-family:inherit;outline:none;resize:vertical;transition:border-color var(--tr),box-shadow var(--tr);}
.ff input:focus,.ff select:focus,.ff textarea:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(106,13,173,.12);}
.ff select option{background:var(--bg2);}
.ff input::placeholder,.ff textarea::placeholder{color:var(--t3);}
.full{grid-column:1/-1;}

/* BUTTONS */
.btn{padding:10px 22px;border-radius:var(--r);font-size:13.5px;font-weight:600;font-family:'Syne',sans-serif;transition:all var(--tr);display:inline-flex;align-items:center;gap:6px;}
.bp{background:var(--p);color:#fff;box-shadow:0 0 20px rgba(106,13,173,.2);}
.bp:hover{background:var(--ph);box-shadow:0 0 30px rgba(106,13,173,.3);transform:translateY(-1px);}
.bg{background:transparent;border:1px solid var(--bd2);color:var(--t2);}
.bg:hover{border-color:var(--p);color:var(--acc);}
.br{display:flex;justify-content:flex-end;gap:10px;margin-top:24px;}

/* FILTERS */
.flt{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;}
.fc{padding:8px 12px;background:var(--card);border:1px solid var(--bd2);border-radius:var(--r);color:var(--t2);font-size:13px;font-family:inherit;outline:none;transition:border-color var(--tr);}
.fc:focus{border-color:var(--p);}
.fc option{background:var(--bg2);}

/* TABS */
.tabs{display:flex;border-bottom:1px solid var(--bd);margin-bottom:28px;gap:2px;}
.tbtn{padding:9px 18px;font-size:13.5px;font-weight:500;color:var(--t2);border-radius:var(--r) var(--r) 0 0;border:1px solid transparent;border-bottom:none;transition:all var(--tr);}
.tbtn:hover{color:var(--t);background:var(--rh);}
.tbtn.on{background:var(--card);border-color:var(--bd);color:var(--t);font-weight:600;margin-bottom:-1px;}

/* MODAL */
.mwrap{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity var(--tr);}
.mwrap.on{opacity:1;pointer-events:auto;}
.modal{background:var(--bg2);border:1px solid var(--bd2);border-radius:var(--rxl);padding:36px;width:480px;max-width:95vw;max-height:90vh;overflow-y:auto;transform:translateY(16px) scale(.98);transition:transform var(--tr);box-shadow:var(--shlg);}
.mwrap.on .modal{transform:none;}
.mhdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;}
.mtitle{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;}
.mclose{width:30px;height:30px;border-radius:7px;background:var(--bd);color:var(--t2);font-size:16px;display:flex;align-items:center;justify-content:center;transition:background var(--tr);}
.mclose:hover{background:rgba(240,64,64,.15);color:var(--bug);}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;z-index:9000;background:var(--bg3);border:1px solid var(--bd2);color:var(--t);padding:13px 18px;border-radius:var(--rl);font-size:13px;font-weight:500;box-shadow:var(--shlg);transform:translateY(60px);opacity:0;transition:all .3s cubic-bezier(.16,1,.3,1);display:flex;align-items:center;gap:9px;}
.tdot{width:7px;height:7px;border-radius:50%;background:var(--mel);flex-shrink:0;}
.toast.on{transform:translateY(0);opacity:1;}

/* PRODUCT LIST */
.plist{display:flex;flex-direction:column;gap:12px;}
.pitem{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:22px 24px;display:flex;align-items:center;gap:18px;cursor:pointer;transition:all .2s;}
.pitem:hover{border-color:var(--p);transform:translateX(3px);box-shadow:var(--sh);}
.pitem:hover .parrow{transform:translateX(4px);color:var(--acc);}
.pico{width:44px;height:44px;border-radius:10px;background:rgba(106,13,173,.15);border:1px solid rgba(106,13,173,.2);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.pico svg{width:20px;height:20px;color:var(--acc);}
.pinf{flex:1;}
.pname{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;}
.pdsc{font-size:12.5px;color:var(--t2);margin-top:3px;}
.parrow{color:var(--t3);font-size:18px;transition:transform .2s,color .2s;}
.disc{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:20px 22px;opacity:.55;display:flex;align-items:flex-start;gap:14px;}
.dbadge{flex-shrink:0;padding:3px 9px;border-radius:5px;font-size:10.5px;font-weight:700;letter-spacing:.3px;background:rgba(240,64,64,.1);color:var(--bug);white-space:nowrap;margin-top:2px;}

/* MOBILE */
.hmenu{display:none;width:34px;height:34px;align-items:center;justify-content:center;color:var(--t);margin-right:12px;}
.hback{display:none;width:34px;height:34px;align-items:center;justify-content:center;color:var(--t);margin-right:8px;}
.sb-back{display:none;width:100%;padding:14px 18px;text-align:left;font-size:13px;font-weight:600;color:var(--t2);border-bottom:1px solid var(--bd);margin-bottom:10px;align-items:center;gap:10px;transition:color .2s;background:transparent;border-top:none;border-left:none;border-right:none;}
.sb-back:hover{color:var(--t);}
#sb-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:450;display:none;opacity:0;transition:opacity var(--tr);backdrop-filter:blur(2px);}
#sb-overlay.on{display:block;opacity:1;}
.sb-mob-nav{display:none;flex-direction:column;padding-bottom:10px;}
@media(max-width:768px){
  nav{display:none;}
  #sb{position:fixed;top:58px;bottom:0;left:0;z-index:500;transform:translateX(-100%);transition:transform var(--tr);width:260px;}
  #sb.mob{transform:translateX(0);box-shadow:var(--shlg);}
  .sb-back{display:flex;}
  .husr span{display:none;}
  .hmenu{display:flex;}
  .hback.active{display:flex;}
  .sb-mob-nav{display:flex;}
  .hlogo{margin-right:auto;}
  .tw{overflow-x:auto;}
  table{min-width:600px;}
}
</style>
</head>
<body>

<div id="ls">
  <div class="lbg"></div>
  <div class="llines"></div>
  <div class="lcard">
    <div class="lmark">SUN <strong>SOFTWARES</strong></div>
    <div class="ltag">Portal Interno TI &middot; Acesso Autenticado</div>
    <div class="lf"><label>Login</label><input type="text" id="li" placeholder="seu.login" value="admin" autocomplete="off"></div>
    <div class="lf"><label>Senha</label><input type="password" id="lp" placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" value="admin123"></div>
    <button class="lbtn" onclick="doLogin()">Entrar</button>
    <div class="lerr" id="lerr">Credenciais inválidas. Tente novamente.</div>
    <div class="lhint">Demo: admin / admin123 &middot; visitante / 1234</div>
  </div>
</div>

<div class="toast" id="toast"><span class="tdot"></span><span id="tmsg"></span></div>

<div class="mwrap" id="mu">
  <div class="modal">
    <div class="mhdr"><span class="mtitle" id="mut">Novo Usuário</span><button class="mclose" onclick="cm('mu')">&#x2715;</button></div>
    <div style="display:grid;gap:14px">
      <div class="fgrid">
        <div class="ff"><label>Nome completo</label><input type="text" id="u_name" placeholder="Carlos Mendes"></div>
        <div class="ff"><label>Login</label><input type="text" id="u_login" placeholder="carlos.mendes"></div>
        <div class="ff"><label>Senha</label><input type="password" id="u_pass" placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;"></div>
        <div class="ff"><label>Departamento</label><input type="text" id="u_dept" placeholder="TI, Financeiro..."></div>
        <div class="ff"><label>Nível de Acesso</label><select id="u_role"><option>Visualizador</option><option>Editor</option><option>Administrador</option></select></div>
      </div>
      <div class="br" style="margin-top:8px">
        <button class="btn bg" onclick="cm('mu')">Cancelar</button>
        <button class="btn bp" onclick="saveU()">Cadastrar</button>
      </div>
    </div>
  </div>
</div>

<div class="mwrap" id="mv">
  <div class="modal">
    <div class="mhdr"><span class="mtitle" id="mvt"></span><button class="mclose" onclick="cm('mv')"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>
    <div id="mvc" style="display:flex;flex-direction:column;gap:10px;max-height:60vh;overflow-y:auto"></div>
  </div>
</div>

<div class="mwrap" id="mw">
  <div class="modal" style="text-align:center;width:400px">
    <div id="mw-msg" style="margin-bottom:16px;font-family:'Syne',sans-serif;font-size:20px;font-weight:800">Olá, visitante.</div>
    <div style="color:var(--t2);font-size:14px;line-height:1.6;margin-bottom:24px">Esse site contém informações meramente fictícias para apresentar a ideia.</div>
    <button class="btn bp" style="width:100%;justify-content:center" onclick="cm('mw')">Continuar</button>
  </div>
</div>

<div id="app">
  <header>
    <button class="hmenu" onclick="toggleSB()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
    <button class="hback" id="hb" onclick="goBack()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg></button>
    <div class="hlogo">SUN <strong>SOFTWARES</strong></div>
    <nav id="hnav">
      <button class="nitem" data-p="erp" onclick="nav('erp')">ERP-Sunsoft</button>
      <button class="nitem" data-p="relatorios" onclick="nav('relatorios')">Relatórios-Sunsoft</button>
      <button class="nitem" data-p="usuarios" onclick="nav('usuarios')">Usuários</button>
    </nav>
    <div class="hright">
      <div class="husr"><div class="hav" id="hav">A</div><span id="hun">Admin</span></div>
      <button class="hibtn" id="tbtn" onclick="toggleTheme()">
        <svg id="tico" viewBox="0 0 20 20" fill="currentColor" width="16" height="16"><path id="tpath" fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4.22 1.78a1 1 0 011.42 1.42l-.71.7a1 1 0 11-1.42-1.41l.71-.71zM18 9a1 1 0 010 2h-1a1 1 0 010-2h1zm-1.78 5.78a1 1 0 00-1.42 1.42l.7.71a1 1 0 001.42-1.42l-.7-.71zm-12.44 0l-.7.71A1 1 0 005.5 16.9l.71-.71a1 1 0 00-1.42-1.42zM4 10a1 1 0 01-1 1H2a1 1 0 010-2h1a1 1 0 011 1zm1.78-6.22a1 1 0 00-1.42 1.41l.71.71A1 1 0 106.5 4.49l-.71-.71zM10 6a4 4 0 100 8 4 4 0 000-8z"/></svg>
      </button>
      <button class="hlout" onclick="doLogout()">Sair</button>
    </div>
  </header>
  <div id="layout">
    <aside id="sb"></aside>
    <main id="pa"></main>
  </div>
  <div id="sb-overlay" onclick="hideSB()"></div>
</div>

<script>
/* DATA */
const DB={
  users:[
    {id:1,name:'Administrador',  login:'admin',     role:'Administrador',dept:'TI',      status:'Ativo',pass:'admin123'},
    {id:2,name:'Visitante',      login:'visitante', role:'Visualizador', dept:'Externo', status:'Ativo',pass:'1234'},
  ],
  home:{
    noticias:[
      {date:'21/02/2026',tipo:'ajuste',titulo:'Atualização Programada do Servidor',          desc:'Manutenção preventiva no servidor principal em 23/02/2026 das 22h às 23h30. Poderá ocorrer instabilidade no ERP-Sunsoft.',resp:'Infraestrutura TI'},
      {date:'15/02/2026',tipo:'mel',   titulo:'Novo Módulo de Controle de Lotes',            desc:'Liberado recurso de controle de lotes no módulo Estoque, com rastreabilidade completa por fornecedor e data de validade.',versao:'2.4.0'},
      {date:'05/02/2026',tipo:'bug',   titulo:'Correção de Emissão de NF-e',                 desc:'Corrigido erro intermitente na emissão de NF-e em operações interestaduais.',versao:'2.3.9'},
    ],
    descontinuados:[
      {nome:'Módulo Relatórios Legacy',data:'01/03/2026',motivo:'Substituído pelo Relatórios-Sunsoft BI.'},
    ],
  },
  erp:{
    estoque:[
      {date:'20/02/2026',tipo:'mel',   versao:'2.4.0',titulo:'Melhoria na Performance de Consulta',desc:'Tempo de carregamento do inventário reduzido de 3.2s para 1.1s após otimização de queries.'},
      {date:'12/02/2026',tipo:'bug',   versao:'2.3.8',titulo:'Correção de Divergência de Saldo',   desc:'Corrigida inconsistência na atualização de saldo após cancelamento de pedido.'},
      {date:'28/01/2026',tipo:'ajuste',versao:'2.3.7',titulo:'Ajuste na Tela de Cadastro',         desc:'Layout do cadastro de produto atualizado para incluir campo obrigatório "Categoria Fiscal".'},
    ],
    notas:[
      {date:'18/02/2026',tipo:'ajuste',versao:'2.4.0',titulo:'Atualização de Layout SEFAZ',  desc:'Schema XML atualizado para versão 4.1 exigida pela SEFAZ.'},
      {date:'07/02/2026',tipo:'bug',   versao:'2.3.9',titulo:'Correção de Alíquota ICMS-ST', desc:'Corrigido cálculo em operações com substituição tributária para o estado de MG.'},
      {date:'25/01/2026',tipo:'mel',   versao:'2.3.6',titulo:'Inclusão de Log de Rejeição',  desc:'Adicionado log detalhado para rejeições automáticas da NF-e.'},
    ],
    versoes:[
      {v:'2.4.0', date:'20/02/2026',status:'estavel',alt:'Controle de lotes, otimização de inventário, atualização layout NF-e',resp:'Carlos Mendes'},
      {v:'2.3.9', date:'05/02/2026',status:'estavel',alt:'Correção emissão NF-e, cálculo ICMS-ST',resp:'Juliana Ribeiro'},
      {v:'2.3.8', date:'12/02/2026',status:'hotfix', alt:'Correção divergência de saldo no estoque',resp:'Carlos Mendes'},
      {v:'2.3.7', date:'28/01/2026',status:'estavel',alt:'Campo Categoria Fiscal no cadastro de produto',resp:'Juliana Ribeiro'},
    ],
    db:{
      status:'ONLINE',cpu:64,pico:89,
      hist:[
        {date:'03/02/2026',tipo:'aj',causa:'Processo de importação em lote',impacto:'12 minutos'},
        {date:'17/01/2026',tipo:'bug',causa:'Reinício após atualização de segurança',impacto:'7 minutos'},
      ],
      mel:[
        {titulo:'Indexação em MOV_ESTOQUE',desc:'Índice composto criado para consultas por período, reduzindo o tempo de relatórios em ~60%.'},
        {titulo:'Monitoramento em tempo real',desc:'Agente de coleta de métricas com alertas automáticos para sobrecarga acima de 85%.'},
        {titulo:'Ajuste de pool de conexões',desc:'Limite revisado de 50 para 120 conexões simultâneas após análise de gargalo em horário de pico.'},
      ],
      carga:[{m:'Ago',v:42},{m:'Set',v:55},{m:'Out',v:48},{m:'Nov',v:73},{m:'Dez',v:61},{m:'Jan',v:64},{m:'Fev',v:47}],
    },
  },
  relatorios:{
    atu:[
      {date:'14/02/2026',tipo:'mel',   titulo:'Dashboard Financeiro',desc:'Incluído filtro por centro de custo no dashboard financeiro.'},
      {date:'10/02/2026',tipo:'bug',   titulo:'Relatório de Vendas', desc:'Correção no agrupamento por representante comercial no relatório mensal.'},
      {date:'02/02/2026',tipo:'mel',   titulo:'Exportação Excel',    desc:'Melhoria na formatação automática de colunas monetárias na exportação XLSX.'},
    ],
  },
  chamados:[
    {id:'#1452',dept:'Financeiro', prod:'ERP-Sunsoft',        tipo:'bug',   desc:'NF-e não valida CFOP corretamente.',                              status:'Em andamento',prior:'Alta',  date:'18/02/2026'},
    {id:'#1447',dept:'Comercial',  prod:'Relatórios-Sunsoft', tipo:'mel',   desc:'Filtro por vendedor no relatório mensal.',                        status:'Finalizado',  prior:'Média', date:'12/02/2026'},
    {id:'#1433',dept:'Logística',  prod:'ERP-Sunsoft',        tipo:'ajuste',desc:'Alterar ordem padrão da listagem de produtos por código.',        status:'Finalizado',  prior:'Baixa', date:'30/01/2026'},
    {id:'#1420',dept:'Financeiro', prod:'ERP-Sunsoft',        tipo:'bug',   desc:'Relatório de contas a pagar exibe duplicidade em datas.',         status:'Finalizado',  prior:'Alta',  date:'22/01/2026'},
    {id:'#1415',dept:'Comercial',  prod:'ERP-Sunsoft',        tipo:'mel',   desc:'Dashboard de metas com visualização por período.',               status:'Em andamento',prior:'Média', date:'20/01/2026'},
  ],
  relMensal:{
    jan:{bugs:18,mel:12,aj:9},
    fev:{bugs:11,mel:15,aj:6},
    depts:[{n:'Financeiro',v:14},{n:'Comercial',v:11},{n:'Logística',v:9},{n:'TI',v:6},{n:'RH',v:4}],
  },
};

/* STATE */
let CU=null,CP='',CProd='',CSub='home-prod',CTab='abrir',editId=null;
let HIST=[],isBack=false;

/* UTILS */
function tag(t){const m={bug:['tbug','Bug'],mel:['tmel','Melhoria'],ajuste:['taj','Ajuste'],hotfix:['tfix','Hotfix'],aj:['taj','Ajuste']};const[c,l]=m[t]||['tinfo',t];return`<span class="tag ${c}">${l}</span>`;}
function tdot(t){return{bug:'dbug',mel:'dmel',ajuste:'daj',hotfix:'dfix',aj:'daj'}[t]||'daj';}
function spill(s){const m={estavel:['pg','Estável'],beta:['py','Beta'],hotfix:['pf','Hotfix'],teste:['pu','Em Teste']};const[c,l]=m[s]||['pu',s];return`<span class="pill ${c}">${l}</span>`;}
function pDate(s){const p=s.split('/');return new Date(p[2],p[1]-1,p[0]);}
function act(t,a,i){toast(`Ação: ${a} em ${t} (ID/Index: ${i})`);}
function pcol(p){return p==='Alta'||p==='Crítica'?'var(--bug)':p==='Média'?'var(--aj)':'var(--t3)';}
function piePath(start,end){
  const x1=Math.cos(2*Math.PI*start),y1=Math.sin(2*Math.PI*start);
  const x2=Math.cos(2*Math.PI*end),y2=Math.sin(2*Math.PI*end);
  return `M 0 0 L ${x1} ${y1} A 1 1 0 ${end-start>.5?1:0} 1 ${x2} ${y2} Z`;
}
function chst(s){const c=s==='Finalizado'?'var(--mel)':s==='Em andamento'?'var(--aj)':'var(--bug)';return`<span style="display:inline-flex;align-items:center;gap:5px"><span style="width:6px;height:6px;border-radius:50%;background:${c};display:inline-block"></span>${s}</span>`;}
function tlItem(d,i,t){
  const b=CU?.role==='Administrador'?`<div style="position:absolute;top:12px;right:12px;display:flex;gap:6px"><button onclick="act('${t}','edit',${i})" style="color:var(--t2)">${iEdit()}</button><button onclick="act('${t}','del',${i})" style="color:var(--bug)">${iTrash()}</button></div>`:'';
  return`<div class="tli"><div class="tld ${tdot(d.tipo)}"></div><div class="tlc" style="position:relative;padding-right:40px">${b}<div class="tlm"><span class="tdate">${d.date}</span>${tag(d.tipo)}${d.versao?`<span class="tver">${d.versao}</span>`:''}</div><h4>${d.titulo}</h4><p>${d.desc}</p></div></div>`;
}
function toast(m){document.getElementById('tmsg').textContent=m;const t=document.getElementById('toast');t.classList.add('on');setTimeout(()=>t.classList.remove('on'),3200);}
function om(id){document.getElementById(id).classList.add('on');}
function cm(id){document.getElementById(id).classList.remove('on');}
function setPage(h){document.getElementById('pa').innerHTML=h;}

function showVersion(v){
  const l=[...DB.erp.estoque,...DB.erp.notas,...DB.home.noticias].filter(i=>i.versao===v);
  const h=l.length?l.map(i=>`
    <div class="pitem" style="cursor:default;padding:16px">
      <div class="pico" style="width:36px;height:36px;background:${i.tipo==='bug'?'rgba(240,64,64,.1)':i.tipo==='mel'?'rgba(46,204,113,.1)':'rgba(245,166,35,.1)'};color:${i.tipo==='bug'?'var(--bug)':i.tipo==='mel'?'var(--mel)':'var(--aj)'}">${i.tipo==='bug'?iTkt():i.tipo==='mel'?iList():iBox()}</div>
      <div class="pinf">
        <div class="pname" style="font-size:14px">${i.titulo}</div>
        <div class="pdsc">${i.desc}</div>
        <div style="margin-top:6px">${tag(i.tipo)}</div>
      </div>
    </div>`).join(''):'<div style="text-align:center;color:var(--t2);padding:20px">Sem detalhes registrados para esta versão.</div>';
  document.getElementById('mvt').textContent='Detalhes da Versão '+v;
  document.getElementById('mvc').innerHTML=h;
  om('mv');
}

function printVersion(v){
  const ver = DB.erp.versoes.find(x=>x.v===v);
  const items = [...DB.erp.estoque,...DB.erp.notas,...DB.home.noticias].filter(i=>i.versao===v);
  
  const w = window.open('', '_blank');
  w.document.write(`
    <html>
    <head>
      <title>Relatório de Versão - ${v}</title>
      <style>
        body{font-family:'Segoe UI', sans-serif;padding:40px;color:#333;max-width:800px;margin:0 auto;}
        h1{margin-bottom:10px;border-bottom:2px solid #6A0DAD;padding-bottom:10px;color:#6A0DAD;}
        .meta{margin-bottom:30px;color:#555;font-size:14px;background:#f9f9f9;padding:15px;border-radius:8px;}
        .item{margin-bottom:15px;border-bottom:1px solid #eee;padding-bottom:15px;}
        .tag{display:inline-block;padding:2px 6px;border-radius:4px;font-size:11px;font-weight:bold;text-transform:uppercase;color:white;margin-right:8px;vertical-align:middle;}
        .bug{background:#F04040;} .mel{background:#2ECC71;} .ajuste{background:#F5A623;} .hotfix{background:#FF6B35;}
        .t{font-weight:bold;font-size:15px;margin-bottom:4px;}
        .d{font-size:13px;line-height:1.5;color:#444;}
      </style>
    </head>
    <body>
      <h1>Relatório de Build: Versão ${v}</h1>
      <div class="meta">
        <strong>Data de Lançamento:</strong> ${ver.date}<br>
        <strong>Status:</strong> ${ver.status.toUpperCase()}<br>
        <strong>Responsável:</strong> ${ver.resp}
      </div>
      <h3>Itens do Pacote</h3>
      ${items.length ? items.map(i=>`<div class="item"><div class="t"><span class="tag ${i.tipo}">${i.tipo}</span>${i.titulo}</div><div class="d">${i.desc}</div></div>`).join('') : '<p>Nenhum item detalhado registrado.</p>'}
      <div style="margin-top:40px;font-size:11px;color:#999;text-align:center;border-top:1px solid #eee;padding-top:10px;">Gerado pelo Portal Interno TI - SUN SOFTWARES</div>
      <script>window.print();<\/script>
    </body></html>`);
  w.document.close();
}

function printReport(){
  const jan=DB.relMensal.jan,fev=DB.relMensal.fev,dp=DB.relMensal.depts;
  const w = window.open('', '_blank');
  w.document.write(`
    <html>
    <head>
      <title>Relatório Mensal de Chamados</title>
      <style>
        body{font-family:'Segoe UI', sans-serif;padding:40px;color:#333;max-width:800px;margin:0 auto;}
        h1{margin-bottom:10px;border-bottom:2px solid #6A0DAD;padding-bottom:10px;color:#6A0DAD;}
        h2{margin-top:30px;font-size:18px;border-bottom:1px solid #ccc;padding-bottom:5px;}
        .meta{margin-bottom:30px;color:#555;font-size:14px;background:#f9f9f9;padding:15px;border-radius:8px;}
        table{width:100%;border-collapse:collapse;margin-top:15px;}
        th,td{padding:10px;border:1px solid #ddd;text-align:left;font-size:13px;}
        th{background:#f5f5f5;font-weight:bold;}
        .stat-box{display:inline-block;width:45%;margin-bottom:20px;vertical-align:top;}
        .stat-val{font-size:24px;font-weight:bold;color:#6A0DAD;}
        .stat-lbl{font-size:12px;color:#666;text-transform:uppercase;}
      </style>
    </head>
    <body>
      <h1>Relatório de Indicadores de Chamados</h1>
      <div class="meta">
        <strong>Período:</strong> Janeiro/2026 - Fevereiro/2026<br>
        <strong>Gerado em:</strong> ${new Date().toLocaleDateString()}<br>
        <strong>Solicitante:</strong> ${CU?.name || 'Sistema'}
      </div>
      <div style="margin-bottom:30px">
        <div class="stat-box"><div class="stat-lbl">Total Janeiro</div><div class="stat-val">${jan.bugs+jan.mel+jan.aj}</div><div style="font-size:12px;color:#555">Bugs: ${jan.bugs} | Melh: ${jan.mel} | Aj: ${jan.aj}</div></div>
        <div class="stat-box"><div class="stat-lbl">Total Fevereiro</div><div class="stat-val">${fev.bugs+fev.mel+fev.aj}</div><div style="font-size:12px;color:#555">Bugs: ${fev.bugs} | Melh: ${fev.mel} | Aj: ${fev.aj}</div></div>
      </div>
      <h2>Distribuição por Departamento</h2>
      <table><thead><tr><th>Departamento</th><th>Chamados</th><th>% do Total</th></tr></thead><tbody>${dp.map(d=>`<tr><td>${d.n}</td><td>${d.v}</td><td>${((d.v/dp.reduce((a,b)=>a+b.v,0))*100).toFixed(1)}%</td></tr>`).join('')}</tbody></table>
      <div style="margin-top:40px;font-size:11px;color:#999;text-align:center;border-top:1px solid #eee;padding-top:10px;">Gerado pelo Portal Interno TI - SUN SOFTWARES</div>
      <script>window.print();<\/script></body></html>`);
  w.document.close();
}

/* LOGIN */
function doLogin(){
  const l=document.getElementById('li').value.trim(),p=document.getElementById('lp').value;
  const u=DB.users.find(x=>x.login===l&&x.pass===p);
  if(!u){document.getElementById('lerr').classList.add('on');return;}
  document.getElementById('lerr').classList.remove('on');
  CU=u;
  document.getElementById('hav').textContent=u.name[0];
  document.getElementById('hun').textContent=u.name.split(' ')[0];
  document.getElementById('mw-msg').textContent=`Olá, ${u.name}.`;
  const ls=document.getElementById('ls');
  ls.style.transition='opacity .4s';ls.style.opacity='0';
  setTimeout(()=>{ls.style.display='none';document.getElementById('app').classList.add('on');nav('erp');om('mw');},380);
}
function doLogout(){CU=null;document.getElementById('app').classList.remove('on');const ls=document.getElementById('ls');ls.style.display='flex';ls.style.opacity='1';}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.getElementById('ls').style.display!=='none')doLogin();});

/* THEME */
const ST=localStorage.getItem('sun-t')||'dark';
document.documentElement.setAttribute('data-theme',ST);updateTico(ST);
function toggleTheme(){const n=document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',n);localStorage.setItem('sun-t',n);updateTico(n);}
function updateTico(t){const p=document.getElementById('tpath');if(!p)return;if(t==='dark'){p.setAttribute('d','M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4.22 1.78a1 1 0 011.42 1.42l-.71.7a1 1 0 11-1.42-1.41l.71-.71zM18 9a1 1 0 010 2h-1a1 1 0 010-2h1zm-1.78 5.78a1 1 0 00-1.42 1.42l.7.71a1 1 0 001.42-1.42l-.7-.71zm-12.44 0l-.7.71A1 1 0 005.5 16.9l.71-.71a1 1 0 00-1.42-1.42zM4 10a1 1 0 01-1 1H2a1 1 0 010-2h1a1 1 0 011 1zm1.78-6.22a1 1 0 00-1.42 1.41l.71.71A1 1 0 106.5 4.49l-.71-.71zM10 6a4 4 0 100 8 4 4 0 000-8z');}else{p.setAttribute('d','M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z');}}

/* NAV */
function record(fn,arg){if(isBack)return;const l=HIST[HIST.length-1];if(l&&l.f===fn&&l.a===arg)return;HIST.push({f:fn,a:arg});updHb();}
function goBack(){if(HIST.length<2)return;HIST.pop();const p=HIST[HIST.length-1];isBack=true;p.f(p.a);isBack=false;updHb();}
function updHb(){const b=document.getElementById('hb');if(b)b.classList.toggle('active',HIST.length>1);}

function nav(page){
  record(nav,page);
  CP=page;
  document.querySelectorAll('.nitem').forEach(b=>b.classList.toggle('on',b.dataset.p===page));
  if(page==='erp')goP('erp');
  else if(page==='relatorios')goP('relatorios');
  else if(page==='usuarios')rUsuarios();
}
function hideSB(){document.getElementById('sb').classList.remove('on','mob');document.getElementById('sb-overlay').classList.remove('on');}
function toggleSB(){
  const sb=document.getElementById('sb'),ov=document.getElementById('sb-overlay');
  sb.classList.toggle('mob');
  if(sb.classList.contains('mob'))ov.classList.add('on');
  else ov.classList.remove('on');
}

/* SIDEBAR */
function setSB(prod){
  CProd=prod;
  const sb=document.getElementById('sb');
  const name=prod==='erp'?'ERP-Sunsoft':'Relatórios-Sunsoft';
  const subs=prod==='erp'
    ?[{id:'home-prod',i:iHome(),l:'Home'},{id:'chamados-prod',i:iTkt(),l:'Chamados'},{id:'rel-chamados',i:iRep(),l:'Relatórios Chamados'},{id:'versoes',i:iTag(),l:'Versões'},{id:'estoque',i:iBox(),l:'Estoque'},{id:'notas',i:iDoc(),l:'Notas Fiscais'},{id:'db',i:iDb(),l:'DB Manager'}]
    :[{id:'home-prod',i:iHome(),l:'Home'},{id:'chamados-prod',i:iTkt(),l:'Chamados'},{id:'rel-chamados',i:iRep(),l:'Relatórios Chamados'},{id:'atualizacoes',i:iList(),l:'Atualizações'}];
  sb.innerHTML=`
    <div class="sb-mob-nav">
      <button class="sb-back" onclick="hideSB()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>Voltar</button>
      <div class="sbph" style="padding-top:0;border:none"><div class="sbsl" style="padding-left:0">Navegação</div></div>
      <button class="sbi ${CP==='erp'?'on':''}" onclick="nav('erp')"><span class="sbic">${iProd()}</span>ERP-Sunsoft</button>
      <button class="sbi ${CP==='relatorios'?'on':''}" onclick="nav('relatorios')"><span class="sbic">${iRep()}</span>Relatórios-Sunsoft</button>
      <button class="sbi ${CP==='usuarios'?'on':''}" onclick="nav('usuarios')"><span class="sbic">${iUser()}</span>Usuários</button>
      <div class="sbdv"></div>
    </div>
    <div class="sbph"><div class="sbpn">${name}</div><div class="sbps">Portal Interno TI</div></div>
    <div class="sbsl">Módulos</div>
    ${subs.map(s=>`<button class="sbi ${CSub===s.id?'on':''}" onclick="openSub('${s.id}')"><span class="sbic">${s.i}</span>${s.l}</button>`).join('')}
    <div style="flex:1"></div>
    <div class="sbdv"></div>`;
  sb.classList.add('on');
}

function openSub(sub){record(openSub,sub);CSub=sub;setSB(CProd);if(sub==='home-prod')rHomeProd();else if(sub==='chamados-prod')rChamados('consultar');else if(sub==='rel-chamados')rChamados('relatorio');else if(sub==='versoes')rVersoes();else if(sub==='estoque')rEstoque();else if(sub==='notas')rNotas();else if(sub==='db')rDB();else if(sub==='atualizacoes')rRelAtu();if(window.innerWidth<=768)hideSB();}

/* ICONS */
function iHome(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h4v-3h2v3h4a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg>`;}
function iTkt(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2 2 2 0 000 4 2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2a2 2 0 012-2 2 2 0 000-4 2 2 0 01-2-2V5z" clip-rule="evenodd"/></svg>`;}
function iTag(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>`;}
function iBox(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"/><path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>`;}
function iDoc(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/></svg>`;}
function iDb(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"/><path d="M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"/><path d="M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"/></svg>`;}
function iList(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>`;}
function iProd(){return`<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z"/></svg>`;}
function iRep(){return`<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>`;}
function iUser(){return`<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>`;}
function iEdit(){return`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`;}
function iTrash(){return`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`;}
function iPlus(){return`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`;}

/* PAGES */
function rProdutos(){
  hideSB();
  setPage(`
    <div class="phdr"><div class="ptitle">Produtos</div><div class="pdesc">Selecione um produto para acessar módulos e histórico técnico.</div></div>
    <div class="slbl">Sistemas Ativos</div>
    <div class="plist">
      <div class="pitem" onclick="goP('erp')">
        <div class="pico">${iProd()}</div>
        <div class="pinf"><div class="pname">ERP-Sunsoft</div><div class="pdsc">Sistema integrado — Estoque, NF-e, Versões e Banco de Dados.</div></div>
        <span class="parrow">&#8250;</span>
      </div>
      <div class="pitem" onclick="goP('relatorios')">
        <div class="pico">${iRep()}</div>
        <div class="pinf"><div class="pname">Relatórios-Sunsoft</div><div class="pdsc">Plataforma de relatórios e dashboards gerenciais. Substitui o módulo Legacy.</div></div>
        <span class="parrow">&#8250;</span>
      </div>
    </div>
    <div class="slbl">Descontinuados</div>
    ${DB.home.descontinuados.map(d=>`
      <div class="disc">
        <span class="dbadge">Descontinuado</span>
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:700;margin-bottom:3px">${d.nome}</div>
          <div style="font-size:12.5px;color:var(--t2)">Data de encerramento: ${d.data} &mdash; ${d.motivo}</div>
        </div>
      </div>`).join('')}
  `);
}

function goP(prod){CProd=prod;CSub='home-prod';setSB(prod);rHomeProd();}

function rHomeProd(){
  const ie=CProd==='erp';
  const name=ie?'ERP-Sunsoft':'Relatórios-Sunsoft';
  const ver=ie?'2.4.0':'1.2.0';
  const news = DB.home.noticias;
  const main = news[0];
  const others = news.slice(1);
  const adm = CU?.role==='Administrador';

  setPage(`
    <div class="np-head">
      <div>
        <div class="np-brand">Jornal do Sistema</div>
        <div class="np-title">${name} <span style="font-weight:300;opacity:0.6">News</span></div>
      </div>
      <div class="np-info">
        ${adm?`<button class="btn bp" style="margin-bottom:10px" onclick="act('news','add',0)">${iPlus()} Nova Notícia</button>`:''}
        <div class="np-lbl">Edição Atual</div><div class="np-ver">v${ver}</div>
      </div>
    </div>
    <div class="np-grid">
      <div class="np-hero">
        ${adm?`<div style="position:absolute;top:0;right:0;display:flex;gap:6px"><button onclick="act('news','edit',0)" style="color:var(--t2)">${iEdit()}</button><button onclick="act('news','del',0)" style="color:var(--bug)">${iTrash()}</button></div>`:''}
        <div class="np-hero-tag">${main.date} &bull; ${tag(main.tipo)}</div>
        <div class="np-h1">${main.titulo}</div>
        <div class="np-lead">${main.desc}</div>
        <div class="np-meta">${main.resp?`<span>Por <strong>${main.resp}</strong></span>`:''} ${main.versao?`<span>Versão: ${main.versao}</span>`:''}</div>
      </div>
      <div class="np-side">
        <div class="np-sec">Outras Manchetes</div>
        ${others.map((n,i)=>`
          <div class="np-card" style="position:relative">
            ${adm?`<div style="position:absolute;top:0;right:0;display:flex;gap:6px"><button onclick="act('news','edit',${i+1})" style="color:var(--t2)">${iEdit()}</button><button onclick="act('news','del',${i+1})" style="color:var(--bug)">${iTrash()}</button></div>`:''}
            <div class="np-hero-tag" style="margin-bottom:8px">${n.date} &bull; ${tag(n.tipo)}</div>
            <div class="np-h2">${n.titulo}</div>
            <div class="np-p">${n.desc}</div>
          </div>`).join('')}
      </div>
    </div>
  `);
}

function rEstoque(){
  const adm=CU?.role==='Administrador';
  setPage(`<div class="phdr"><div class="ptitle">Estoque</div><div class="pdesc">Histórico de atualizações do módulo de estoque.</div></div>${adm?`<div style="margin-bottom:20px;display:flex;justify-content:flex-end"><button class="btn bp" onclick="act('estoque','add',0)">${iPlus()} Novo Item</button></div>`:''}<div class="dvdr"></div><div class="tl">${DB.erp.estoque.map((d,i)=>tlItem(d,i,'estoque')).join('')}</div>`);
}

function rNotas(){
  const adm=CU?.role==='Administrador';
  setPage(`<div class="phdr"><div class="ptitle">Notas Fiscais</div><div class="pdesc">Correções fiscais, alterações sistêmicas e atualizações legais.</div></div>${adm?`<div style="margin-bottom:20px;display:flex;justify-content:flex-end"><button class="btn bp" onclick="act('notas','add',0)">${iPlus()} Nova Nota</button></div>`:''}<div class="dvdr"></div><div class="tl">${DB.erp.notas.map((d,i)=>tlItem(d,i,'notas')).join('')}</div>`);
}

function rVersoes(){
  const adm=CU?.role==='Administrador';
  setPage(`
    <div class="phdr"><div class="ptitle">Versões</div><div class="pdesc">Histórico técnico de versões do ERP-Sunsoft.</div></div>
    ${adm?`<div style="margin-bottom:20px;display:flex;justify-content:flex-end"><button class="btn bp" onclick="act('versoes','add',0)">${iPlus()} Nova Versão</button></div>`:''}
    <div class="dvdr"></div>
    <div class="tw">
      <table>
        <thead><tr><th>Versão</th><th>Data</th><th>Alterações</th><th>Status</th><th>Exportar</th>${adm?'<th>Ações</th>':''}</tr></thead>
        <tbody>
          ${DB.erp.versoes.map((v,i)=>`
            <tr>
              <td><button class="btn bp" style="padding:4px 12px;height:auto;font-size:12px" onclick="showVersion('${v.v}')">${v.v}</button></td>
              <td class="mono">${v.date}</td>
              <td style="color:var(--t2)">${v.alt}</td>
              <td>${spill(v.status)}</td>
              <td><button class="btn bg" style="padding:4px 10px;font-size:11px" onclick="printVersion('${v.v}')">PDF</button></td>
              ${adm?`<td><div style="display:flex;gap:6px"><button onclick="act('versoes','edit',${i})" style="color:var(--t2)">${iEdit()}</button><button onclick="act('versoes','del',${i})" style="color:var(--bug)">${iTrash()}</button></div></td>`:''}
            </tr>`).join('')}
        </tbody>
      </table>
    </div>
  `);
}

function rDB(){
  const d=DB.erp.db;const mx=Math.max(...d.carga.map(x=>x.v));
  const adm=CU?.role==='Administrador';
  setPage(`
    <div class="phdr"><div class="ptitle">DB Manager</div><div class="pdesc">Monitoramento de desempenho e histórico do banco de dados.</div></div>
    <div class="dvdr"></div>
    <div class="srow">
      <div class="scard"><div class="slb">Status do Servidor</div><div class="sval" style="color:var(--mel);font-size:18px;font-weight:700;letter-spacing:.5px">${d.status}</div><div class="ssub">Uptime: 18d 4h 11m</div></div>
      <div class="scard"><div class="slb">Uso Médio de CPU</div><div class="sval" style="color:var(--aj)">${d.cpu}<span style="font-size:18px">%</span></div><div class="ssub">Últimos 30 dias</div></div>
      <div class="scard"><div class="slb">Pico de Carga</div><div class="sval" style="color:var(--bug)">${d.pico}<span style="font-size:18px">%</span></div><div class="ssub">Registrado em 03/02/2026</div></div>
      <div class="scard"><div class="slb">Instabilidades</div><div class="sval" style="color:var(--aj)">${d.hist.length}</div><div class="ssub">Últimos 60 dias</div></div>
    </div>
    <div class="bcc" style="margin-bottom:24px">
      <div class="bct">Carga do Servidor — Últimos 7 Meses (%)</div>
      <div class="bc-wrap">
        <div class="bc-y">${[100,75,50,25,0].map(n=>`<div>${n}</div>`).join('')}</div>
        <div class="bc-canvas">
          <div class="bc-grid">${[1,2,3,4,5].map(()=>`<div class="bc-line"></div>`).join('')}</div>
          ${d.carga.map(c=>`
            <div class="bc-col">
              <div class="tooltip">Carga: ${c.v}%</div>
              <div class="bc-val">${c.v}%</div>
              <div class="bc-bar" style="height:${(c.v/100)*100}%;background:${c.v>=80?'var(--p)':c.v>=60?'var(--blue)':'var(--lblue)'}"></div>
              <div class="bc-lbl">${c.m}</div>
            </div>`).join('')}
        </div>
      </div>
    </div>
    <div class="slbl">Histórico de Instabilidades</div>
    <div class="tw" style="margin-bottom:24px">
      <table>
        <thead><tr><th>Data</th><th>Tipo</th><th>Causa</th><th>Impacto</th></tr></thead>
        <tbody>
          ${d.hist.map(h=>`<tr><td class="mono">${h.date}</td><td>${tag(h.tipo)}</td><td style="color:var(--t2)">${h.causa}</td><td class="mono" style="color:var(--t3)">${h.impacto}</td></tr>`).join('')}
        </tbody>
      </table>
    </div>
    <div class="slbl">Melhorias Implementadas</div>
    ${adm?`<div style="margin-bottom:16px"><button class="btn bp" onclick="act('db','add',0)">${iPlus()} Nova Melhoria</button></div>`:''}
    <div class="cgrid">
      ${d.mel.map((m,i)=>`<div class="card cam" style="position:relative">${adm?`<div style="position:absolute;top:12px;right:12px;display:flex;gap:6px"><button onclick="act('db','edit',${i})" style="color:var(--t2)">${iEdit()}</button><button onclick="act('db','del',${i})" style="color:var(--bug)">${iTrash()}</button></div>`:''}${tag('mel')}<h3>${m.titulo}</h3><p>${m.desc}</p></div>`).join('')}
    </div>
  `);
}

function rRelAtu(){
  const adm=CU?.role==='Administrador';
  setPage(`<div class="phdr"><div class="ptitle">Atualizações</div><div class="pdesc">Histórico de alterações do Relatórios-Sunsoft.</div></div>${adm?`<div style="margin-bottom:20px;display:flex;justify-content:flex-end"><button class="btn bp" onclick="act('rel','add',0)">${iPlus()} Nova Atualização</button></div>`:''}<div class="dvdr"></div><div class="tl">${DB.relatorios.atu.map((d,i)=>tlItem(d,i,'rel')).join('')}</div>`);
}

function openChamado(id){
  const c=DB.chamados.find(x=>x.id===id);
  if(!c)return;
  const h=`
    <div style="display:flex;flex-direction:column;gap:20px">
      <div style="background:var(--bg);padding:20px;border-radius:12px;border:1px solid var(--bd2)">
        <div style="display:flex;justify-content:space-between;margin-bottom:16px">
          <div style="font-size:18px;font-weight:700;color:var(--t)">${c.desc}</div>
          <div class="mono" style="color:var(--t3);font-size:12px">${c.date}</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div><div style="font-size:11px;color:var(--t3);text-transform:uppercase;margin-bottom:5px">Produto</div><div style="font-weight:600;color:var(--t)">${c.prod}</div></div>
          <div><div style="font-size:11px;color:var(--t3);text-transform:uppercase;margin-bottom:5px">Departamento</div><div style="font-weight:600;color:var(--t)">${c.dept}</div></div>
          <div><div style="font-size:11px;color:var(--t3);text-transform:uppercase;margin-bottom:5px">Tipo</div><div>${tag(c.tipo)}</div></div>
          <div><div style="font-size:11px;color:var(--t3);text-transform:uppercase;margin-bottom:5px">Prioridade</div><div style="color:${pcol(c.prior)};font-weight:600">${c.prior}</div></div>
        </div>
      </div>
      <div style="padding:0 4px">
        <div style="font-size:12px;color:var(--t3);margin-bottom:8px;text-transform:uppercase;font-weight:700">Status do Chamado</div>
        <div style="display:flex;align-items:center;justify-content:space-between;background:var(--card);padding:14px;border-radius:10px;border:1px solid var(--bd)">
          ${chst(c.status)}
          <div style="font-size:12px;color:var(--t2)">Atualizado recentemente</div>
        </div>
      </div>
    </div>
  `;
  document.getElementById('mvt').textContent=`Chamado ${c.id}`;
  document.getElementById('mvc').innerHTML=h;
  om('mv');
}

function genChamadosRows(l){
  if(!l.length)return `<tr><td colspan="${CU?.role === 'Administrador' ? 9 : 8}" style="text-align:center;color:var(--t2);padding:20px">Nenhum chamado encontrado.</td></tr>`;
  return l.map(c=>`
    <tr style="cursor:pointer" onclick="openChamado('${c.id}')">
      <td class="mono" style="color:var(--acc);font-weight:600">${c.id}</td>
      <td style="max-width:220px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--t2)">${c.desc}</td>
      <td>${tag(c.tipo)}</td>
      <td style="color:var(--t2);font-size:12px">${c.prod}</td>
      <td style="color:var(--t3);font-size:12px">${c.dept}</td>
      <td style="color:${pcol(c.prior)};font-size:12px;font-weight:600">${c.prior}</td>
      <td>${chst(c.status)}</td>
      <td class="mono">${c.date}</td>
      ${CU?.role === 'Administrador' ? `
        <td><div style="display:flex;gap:6px"><button onclick="act('chamados','edit','${c.id}')" style="color:var(--t2)">${iEdit()}</button><button onclick="act('chamados','del','${c.id}')" style="color:var(--bug)">${iTrash()}</button></div></td>
      ` : ''}
    </tr>`).join('');
}

function filterChamados(){
  const s=document.getElementById('c_search').value.toLowerCase();
  const p=document.getElementById('c_prod').value;
  const t=document.getElementById('c_type').value;
  const st=document.getElementById('c_status').value;
  const res=DB.chamados.filter(c=>{
    const mS=c.id.toLowerCase().includes(s)||c.desc.toLowerCase().includes(s)||c.dept.toLowerCase().includes(s);
    const mP=p===''||c.prod===p;
    const mT=t===''||c.tipo===t;
    const mSt=st===''||c.status===st;
    return mS&&mP&&mT&&mSt;
  });
  document.getElementById('c_tbody').innerHTML=genChamadosRows(res);
}

function exportCSV(){
  const mVal=document.getElementById('d_month').value;
  const pVal=document.getElementById('d_prod').value;
  
  const data=DB.chamados.filter(c=>{
    const dm=c.date.includes('/01/')?'jan':'fev';
    const mm=mVal==='all'||mVal===dm;
    const mp=pVal==='all'||c.prod===pVal;
    return mm&&mp;
  });

  if(!data.length){toast('Sem dados para exportar.');return;}

  let csv="ID,Descricao,Tipo,Produto,Departamento,Prioridade,Status,Data,Horas\n";
  data.forEach(c=>{csv+=`${c.id},"${c.desc.replace(/"/g,'""')}",${c.tipo},${c.prod},${c.dept},${c.prior},${c.status},${c.date},${c.hours||0}\n`;});
  const l=document.createElement("a");l.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);l.download="relatorio_chamados.csv";document.body.appendChild(l);l.click();document.body.removeChild(l);
}

function ensureData(){
  if(DB.chamados.length>15)return;
  const dp=['Financeiro','Comercial','Logística','TI','RH'];
  const pr=['ERP-Sunsoft','Relatórios-Sunsoft'];
  const tp=['bug','mel','ajuste'];
  const pi=['Alta','Média','Baixa'];
  const st=['Aberto','Em andamento','Finalizado'];
  for(let i=0;i<60;i++){
    const m=Math.random()>.45?1:0;
    const d=Math.floor(Math.random()*28)+1;
    DB.chamados.push({
      id:`#${2000+i}`,dept:dp[Math.floor(Math.random()*dp.length)],prod:pr[Math.floor(Math.random()*pr.length)],
      tipo:tp[Math.floor(Math.random()*tp.length)],desc:`Chamado simulado ${i}`,status:st[Math.floor(Math.random()*st.length)],
      prior:pi[Math.floor(Math.random()*pi.length)],date:`${d<10?'0'+d:d}/0${m+1}/2026`,hours:Math.floor(Math.random()*44)+4
    });
  }
}

function updateDashboard(){
  const mVal=document.getElementById('d_month').value;
  const pVal=document.getElementById('d_prod').value;
  
  // Filter
  const data=DB.chamados.filter(c=>{
    const dm=c.date.includes('/01/')?'jan':'fev';
    const mm=mVal==='all'||mVal===dm;
    const mp=pVal==='all'||c.prod===pVal;
    return mm&&mp;
  });

  // Stats
  const total=data.length;
  const bugs=data.filter(x=>x.tipo==='bug').length;
  const mel=data.filter(x=>x.tipo==='mel').length;
  const aj=data.filter(x=>x.tipo==='ajuste').length;
  const crit=data.filter(x=>x.prior==='Alta'||x.prior==='Crítica').length;
  const closed=data.filter(x=>x.status==='Finalizado').length;
  const rate=total?Math.round((closed/total)*100):0;
  
  // Depts
  const depts={};
  data.forEach(c=>{depts[c.dept]=(depts[c.dept]||0)+1;});
  const dList=Object.entries(depts).map(([n,v])=>({n,v})).sort((a,b)=>b.v-a.v);
  const dMax=dList.length?dList[0].v:1;

  // Weeks (Resolution Time)
  const weeks={};
  data.forEach(c=>{
    const dt=pDate(c.date);
    const wk=`Sem ${Math.ceil((dt.getDate()+(new Date(dt.getFullYear(),dt.getMonth(),1).getDay()))/7)}/${dt.getMonth()+1}`;
    if(!weeks[wk])weeks[wk]={c:0,h:0};
    weeks[wk].c++;
    weeks[wk].h+=(c.hours||24);
  });
  const wList=Object.entries(weeks).map(([k,v])=>({k,v:Math.round(v.h/v.c)})).sort((a,b)=>a.k.localeCompare(b.k)); // Avg hours
  const wMax=wList.length?Math.max(...wList.map(x=>x.v)):1;

  // Render
  const h=`
    <div class="cgrid" style="margin-bottom:24px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div class="scard"><div class="slb">Total Selecionado</div><div class="sval">${total}</div><div class="ssub">${bugs} bugs &middot; ${mel} melhorias</div></div>
      <div class="scard"><div class="slb">Taxa de Resolução</div><div class="sval" style="color:var(--mel)">${rate}%</div><div class="ssub">${closed} finalizados</div></div>
      <div class="scard"><div class="slb">Chamados Críticos</div><div class="sval" style="color:var(--bug)">${crit}</div><div class="ssub">Prioridade Alta</div></div>
      <div class="scard"><div class="slb">Tempo Médio (Est.)</div><div class="sval" style="color:var(--acc)">${total?Math.round(data.reduce((a,b)=>a+(b.hours||24),0)/total):0}h</div><div class="ssub">Horas por chamado</div></div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px">
      <div class="bcc" style="grid-column:1/-1">
        <div class="bct">Volume Semanal de Resolução (Horas)</div>
        <div class="bc-wrap" style="height:200px">
          <div class="bc-y">${[40,30,20,10,0].map(n=>`<div>${Math.round((wMax/40)*n)}h</div>`).join('')}</div>
          <div class="bc-canvas"><div class="bc-grid">${[1,2,3,4,5].map(()=>`<div class="bc-line"></div>`).join('')}</div>
            ${wList.map(w=>`<div class="bc-col"><div class="tooltip">${w.v}h Médias</div><div class="bc-val">${w.v}h</div><div class="bc-bar" style="height:${(w.v/wMax)*80}%;background-color:var(--acc)"></div><div class="bc-lbl">${w.k}</div></div>`).join('')}
          </div>
        </div>
      </div>
      <div class="bcc">
        <div class="bct">Distribuição por Tipo</div>
        <div class="bc-wrap">
          <div class="bc-y">${[100,75,50,25,0].map(n=>`<div>${Math.round(total*(n/100))}</div>`).join('')}</div>
          <div class="bc-canvas">
            <div class="bc-grid">${[1,2,3,4,5].map(()=>`<div class="bc-line"></div>`).join('')}</div>
            ${[['Bugs',bugs,'var(--p)'],['Melhorias',mel,'var(--blue)'],['Ajustes',aj,'var(--lblue)']].map(([l,v,c])=>`<div class="bc-col"><div class="tooltip">${v}</div><div class="bc-val">${v}</div><div class="bc-bar" style="height:${total?(v/total)*100:0}%;background-color:${c}"></div><div class="bc-lbl">${l}</div></div>`).join('')}
          </div>
        </div>
      </div>
      <div class="bcc"><div class="bct">Por Departamento</div><div style="margin-top:12px;display:flex;flex-direction:column;justify-content:center;height:140px;overflow-y:auto">${dList.map(d=>`<div class="pr-row"><div class="pr-hdr"><span class="pr-lbl">${d.n}</span><span class="pr-val">${d.v}</span></div><div class="pr-trk"><div class="pr-fil" style="width:${(d.v/dMax)*100}%;background:${d.n==='Financeiro'?'var(--p)':d.n==='Comercial'?'var(--blue)':'var(--t2)'}"></div></div></div>`).join('')}</div></div>
      <div class="bcc"><div class="bct">Prioridade</div><div class="pc-wrap">
        <div style="position:relative;width:130px;height:130px"><svg class="pc-svg" viewBox="-1.2 -1.2 2.4 2.4">${(()=>{let acc=0;return [['Alta',data.filter(x=>x.prior==='Alta').length,'var(--p)'],['Média',data.filter(x=>x.prior==='Média').length,'var(--blue)'],['Baixa',data.filter(x=>x.prior==='Baixa').length,'var(--lblue)']].map(([l,v,c])=>{if(!v)return '';const p=v/total;const h=`<path d="${piePath(acc,acc+p)}" fill="${c}" class="pc-slice"><title>${l}: ${Math.round(p*100)}%</title></path>`;acc+=p;return h;}).join('');})()}<circle cx="0" cy="0" r="0.6" fill="var(--card)"></circle></svg></div>
        <div class="pc-leg">${[['Alta','var(--p)'],['Média','var(--blue)'],['Baixa','var(--lblue)']].map(([l,c])=>`<div class="pc-li"><div class="pc-dot" style="background:${c}"></div>${l}</div>`).join('')}</div>
      </div></div>
    </div>`;
  document.getElementById('d_content').innerHTML=h;
}

function rChamados(tab){
  CTab=tab;
  const tabs=tab==='relatorio'?'':`<div class="tabs">
    <button class="tbtn ${tab==='abrir'?'on':''}" style="${tab==='abrir'?'color:var(--p)':''}" onclick="rChamados('abrir')">Abrir Chamado</button>
    <button class="tbtn ${tab==='consultar'?'on':''}" style="${tab==='consultar'?'color:var(--p)':''}" onclick="rChamados('consultar')">Consultar Chamados</button>
  </div>`;
  let body='';

  if(tab==='abrir'){
    body=`
      <div class="phdr"><div class="ptitle">Abrir Chamado</div><div class="pdesc">Registre um problema, melhoria ou ajuste técnico.</div></div>
      <div class="tw" style="padding:28px">
        <div class="fgrid">
          <div class="ff full"><label>Título</label><input type="text" placeholder="Descreva o problema brevemente"></div>
          <div class="ff"><label>Tipo</label><select><option>Bug</option><option>Melhoria</option><option>Ajuste</option><option>Dúvida</option></select></div>
          <div class="ff"><label>Produto</label><select><option>ERP-Sunsoft</option><option>Relatórios-Sunsoft</option></select></div>
          <div class="ff"><label>Prioridade</label><select><option>Baixa</option><option>Média</option><option selected>Alta</option><option>Crítica</option></select></div>
          <div class="ff"><label>Departamento</label><input type="text" placeholder="Ex: Financeiro, Logística"></div>
          <div class="ff full"><label>Descrição Detalhada</label><textarea rows="5" placeholder="Passos para reproduzir, comportamento esperado, módulo afetado..."></textarea></div>
        </div>
        <div class="br"><button class="btn bg">Limpar</button><button class="btn bp" onclick="toast('Chamado registrado com sucesso — #1453')">Registrar Chamado</button></div>
      </div>`;
  } else if(tab==='consultar'){
    body=`
      <div class="phdr"><div class="ptitle">Consultar Chamados</div><div class="pdesc">Acompanhe o status e histórico de solicitações.</div></div>
      ${CU?.role==='Administrador'?`<div style="margin-bottom:20px;display:flex;justify-content:flex-end"><button class="btn bp" onclick="rChamados('abrir')">${iPlus()} Novo Chamado</button></div>`:''}
      <div class="flt">
        <input type="text" id="c_search" class="fc" placeholder="Pesquisar chamados..." style="flex:1;min-width:200px" oninput="filterChamados()">
        <select id="c_prod" class="fc" onchange="filterChamados()"><option value="">Todos os produtos</option><option>ERP-Sunsoft</option><option>Relatórios-Sunsoft</option></select>
        <select id="c_type" class="fc" onchange="filterChamados()"><option value="">Todos os tipos</option><option value="bug">Bug</option><option value="mel">Melhoria</option><option value="ajuste">Ajuste</option></select>
        <select id="c_status" class="fc" onchange="filterChamados()"><option value="">Todos os status</option><option>Aberto</option><option>Em andamento</option><option>Finalizado</option></select>
      </div>
      <div class="tw">
        <table>
          <thead><tr><th>ID</th><th>Descrição</th><th>Tipo</th><th>Produto</th><th>Depto.</th><th>Prioridade</th><th>Status</th><th>Data</th>
          ${CU?.role === 'Administrador' ? '<th>Ações</th>' : ''}
          </tr></thead>
          <tbody id="c_tbody">${genChamadosRows(DB.chamados)}</tbody>
        </table>
      </div>`;
  } else {
    ensureData();
    body=`
      <div class="phdr"><div class="ptitle">Relatórios</div><div class="pdesc">Indicadores mensais de chamados por categoria e departamento.</div></div>
      <div class="flt" style="justify-content:space-between">
        <div style="display:flex;gap:10px"><select id="d_month" class="fc" onchange="updateDashboard()"><option value="all">Todos os meses</option><option value="fev">Fevereiro 2026</option><option value="jan">Janeiro 2026</option></select>
        <select id="d_prod" class="fc" onchange="updateDashboard()"><option value="all">Todos os produtos</option><option>ERP-Sunsoft</option><option>Relatórios-Sunsoft</option></select></div>
        <div style="display:flex;gap:10px">
          <button class="btn bg" onclick="exportCSV()">CSV</button>
          <button class="btn bg" onclick="printReport()">PDF</button>
        </div>
      </div>
      <div id="d_content"></div>`;
  }
  setPage(tabs+body);
  if(tab!=='abrir'&&tab!=='consultar')updateDashboard();
}

function prepNew(){
  editId=null;
  document.getElementById('mut').textContent='Novo Usuário';
  document.getElementById('u_name').value='';
  document.getElementById('u_login').value='';
  document.getElementById('u_pass').value='';
  document.getElementById('u_dept').value='';
  document.getElementById('u_role').value='Visualizador';
  om('mu');
}

function prepEdit(id){
  const u=DB.users.find(x=>x.id===id);
  if(!u)return;
  editId=id;
  document.getElementById('mut').textContent='Editar Usuário';
  document.getElementById('u_name').value=u.name;
  document.getElementById('u_login').value=u.login;
  document.getElementById('u_pass').value=u.pass;
  document.getElementById('u_dept').value=u.dept;
  document.getElementById('u_role').value=u.role;
  om('mu');
}

function toggleStatus(id){
  const u=DB.users.find(x=>x.id===id);
  if(u.id===1){toast('Não é possível desativar o administrador.');return;}
  u.status=u.status==='Ativo'?'Inativo':'Ativo';
  rUsuarios();
  toast('Status alterado para '+u.status);
}

function rUsuarios(){
  hideSB();
  if(CU?.role!=='Administrador'){
    setPage(`<div style="text-align:center;padding:100px 20px"><div style="width:56px;height:56px;border-radius:14px;background:rgba(240,64,64,.1);border:1px solid rgba(240,64,64,.2);margin:0 auto 20px;display:flex;align-items:center;justify-content:center"><svg width="24" height="24" viewBox="0 0 20 20" fill="var(--bug)"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg></div><div style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800;margin-bottom:8px">Acesso Restrito</div><div style="color:var(--t2);font-size:14px">Esta área é exclusiva para administradores.</div></div>`);
    return;
  }
  const rc=r=>r==='Administrador'?'pu':r==='Editor'?'py':'pg';
  setPage(`
    <div class="phdr"><div class="ptitle">Usuários</div><div class="pdesc">Gerenciamento de contas e permissões de acesso.</div></div>
    <div style="display:flex;justify-content:flex-end;margin-bottom:20px"><button class="btn bp" onclick="prepNew()">+ Novo Usuário</button></div>
    <div class="tw">
      <table>
        <thead><tr><th>Usuário</th><th>Login</th><th>Departamento</th><th>Nível</th><th>Status</th><th>Ações</th></tr></thead>
        <tbody>
          ${DB.users.map(u=>`
            <tr>
              <td><div style="display:flex;align-items:center;gap:10px"><div class="hav" style="border-radius:8px;font-size:12px;flex-shrink:0">${u.name[0]}</div><span style="font-weight:500">${u.name}</span></div></td>
              <td class="mono" style="color:var(--t2)">${u.login}</td>
              <td style="color:var(--t2)">${u.dept}</td>
              <td><span class="pill ${rc(u.role)}">${u.role}</span></td>
              <td><span class="pill ${u.status==='Ativo'?'pg':'pr'}">${u.status}</span></td>
              <td>
                <div style="display:flex;gap:6px">
                  <button class="btn bg" style="padding:4px 10px;font-size:11px" onclick="prepEdit(${u.id})">Editar</button>
                  <button class="btn bg" style="padding:4px 10px;font-size:11px;color:${u.status==='Ativo'?'var(--bug)':'var(--mel)'};border-color:var(--bd2)" onclick="toggleStatus(${u.id})">${u.status==='Ativo'?'Desativar':'Ativar'}</button>
                </div>
              </td>
            </tr>`).join('')}
        </tbody>
      </table>
    </div>
  `);
}

function saveU(){
  const n=document.getElementById('u_name').value.trim();
  const l=document.getElementById('u_login').value.trim();
  const p=document.getElementById('u_pass').value;
  const d=document.getElementById('u_dept').value;
  const r=document.getElementById('u_role').value;
  
  if(!n||!l||!p){toast('Preencha os campos obrigatórios.');return;}
  
  if(editId){
    const u=DB.users.find(x=>x.id===editId);
    if(u){u.name=n;u.login=l;u.pass=p;u.dept=d;u.role=r;toast('Usuário atualizado.');}
  }else{
    const id=Math.max(...DB.users.map(x=>x.id))+1;
    DB.users.push({id,name:n,login:l,pass:p,dept:d,role:r,status:'Ativo'});
    toast('Usuário cadastrado.');
  }
  cm('mu');
  rUsuarios();
}

document.querySelectorAll('.mwrap').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)cm(m.id);}));
updateTico(ST);

/* SWIPE GESTURES */
let tX=0,tY=0;
document.addEventListener('touchstart',e=>{tX=e.touches[0].clientX;tY=e.touches[0].clientY;},{passive:true});
document.addEventListener('touchend',e=>{
  const dX=e.changedTouches[0].clientX-tX,dY=e.changedTouches[0].clientY-tY;
  if(Math.abs(dX)>50&&Math.abs(dX)>Math.abs(dY)){
    if(dX>0&&tX<30&&!document.getElementById('sb').classList.contains('mob'))toggleSB();
    else if(dX<0&&document.getElementById('sb').classList.contains('mob'))hideSB();
  }
},{passive:true});
</script>
</body>
</html>
